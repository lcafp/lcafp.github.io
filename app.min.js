'use strict';

window.onload = function (e) {
  var router = new VueRouter({
    mode: 'history',
    routes: []
  });

  var app = new Vue({
    router: router,

    el: '#app',

    components: {
      'credits': httpVueLoader('./vendor/afp/credits.vue'),
      'logo': httpVueLoader('./vendor/afp/logo.vue'),
      'tabs': httpVueLoader('./tabs.vue')
    },

    data: {
      story: {},
      loaded: false
    },

    created: function created() {
      var url = this.getStory(this.$route.query.lang);
      this.loadStory(url);
    },
    mounted: function mounted() {
      this.pymChild = new pym.Child({ polling: 500 });
    },


    methods: {
      getStory: function getStory(lang) {
        if (lang && lang.length === 2) return './story_' + lang + '.txt';
        return './story_en.txt';
      },
      loadStory: function loadStory(url) {
        var _this2 = this;

        return this.$http.get(url).then(function (response) {
          return archieml.load(response.bodyText);
        }).then(function (json) {
          _this2.story = json;
          _this2.loaded = true;
        }, function (error) {
          _this2.loadStory('./story_en.txt');
        });
      },
      moveTo: function moveTo(i) {
        var elementId = 'zoom' + i;
        if (this.pymChild && this.pymChild.id) {
          this.pymChild.scrollParentToChildEl(elementId);
        } else {
          var element = document.getElementById(elementId);
          document.documentElement.scrollTop = document.body.scrollTop = element.offsetTop;
        }
      }
    }
  });
};
